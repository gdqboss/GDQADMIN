<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>æµ·é²œç¤¾èŠå¤©å®¤</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            min-height: 100vh; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        .login-card { 
            background: white; 
            border-radius: 20px; 
            padding: 40px; 
            width: 100%; 
            max-width: 380px; 
            box-shadow: 0 20px 60px rgba(0,0,0,0.3); 
        }
        .login-header { text-align: center; margin-bottom: 30px; position: relative; }
        .lang-select {
            position: absolute;
            top: -10px;
            right: -10px;
            padding: 5px 10px;
            border-radius: 15px;
            border: 1px solid #ddd;
            background: white;
            font-size: 12px;
            cursor: pointer;
        }
        .login-header h2 { color: #333; margin-bottom: 8px; }
        .login-header p { color: #666; margin: 0; font-size: 14px; }
        .form-control { 
            border-radius: 12px; 
            padding: 14px 15px; 
            border: 2px solid #eee; 
            margin-bottom: 15px;
            font-size: 16px;
        }
        .form-control:focus { border-color: #667eea; box-shadow: none; }
        .btn-login { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            border: none; 
            border-radius: 12px; 
            padding: 14px; 
            font-weight: bold; 
            width: 100%;
            color: white;
            font-size: 16px;
        }
        .btn-login:hover { opacity: 0.9; }
        .alert { border-radius: 10px; padding: 12px; }
        .tips { 
            text-align: center; 
            margin-top: 20px; 
            font-size: 12px; 
            color: #999; 
        }
        .back-link {
            text-align: center;
            margin-top: 15px;
        }
        .back-link a {
            color: #667eea;
            text-decoration: none;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="login-card">
        <div class="login-header">
            <select class="lang-select" id="langSelect" onchange="changeLang(this.value)">
                <option value="zh">ä¸­æ–‡</option>
                <option value="en">English</option>
                <option value="ja">æ—¥æœ¬èª</option>
                <option value="ko">í•œêµ­ì–´</option>
            </select>
            <h2 id="titleText">ğŸ¦ æµ·é²œç¤¾</h2>
            <p id="subtitleText">èŠå¤©å®¤ - è¯·ç™»å½•</p>
        </div>
        
        <div id="errorMsg" class="alert alert-danger" style="display:none;"></div>
        
        <form id="loginForm">
            <input type="text" class="form-control" id="username" placeholder="ç”¨æˆ·å" required>
            <input type="password" class="form-control" id="password" placeholder="å¯†ç " required>
            <button type="submit" class="btn btn-login" id="loginBtn">
                ç™»å½•
            </button>
        </form>
        
        <div class="tips" id="tipsText">
            <p>å¦‚éœ€å¼€é€šè´¦å·ï¼Œè¯·è”ç³»ç®¡ç†å‘˜</p>
        </div>
        
        <div class="back-link">
            <a href="/" id="backLink">â† è¿”å›å·¥ä½œå°</a>
        </div>
    </div>

    <script>
        const i18n = {
            zh: { title: 'ğŸ¦ æµ·é²œç¤¾', subtitle: 'èŠå¤©å®¤ - è¯·ç™»å½•', username: 'ç”¨æˆ·å', password: 'å¯†ç ', login: 'ç™»å½•', tips: 'å¦‚éœ€å¼€é€šè´¦å·ï¼Œè¯·è”ç³»ç®¡ç†å‘˜', back: 'â† è¿”å›å·¥ä½œå°' },
            en: { title: 'ğŸ¦ Haixianshe', subtitle: 'Chat Room - Please Login', username: 'Username', password: 'Password', login: 'Login', tips: 'Contact admin for account', back: 'â† Back to Workspace' },
            ja: { title: 'ğŸ¦ æµ·é®®ç¤¾', subtitle: 'ãƒãƒ£ãƒƒãƒˆ - ãƒ­ã‚°ã‚¤ãƒ³', username: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼å', password: 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰', login: 'ãƒ­ã‚°ã‚¤ãƒ³', tips: 'ç®¡ç†è€…ã«ã”é€£çµ¡ãã ã•ã„', back: 'â† ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹' },
            ko: { title: 'ğŸ¦ í•´ì‚°ì‚¬', subtitle: 'ì±„íŒ…ë°© - ë¡œê·¸ì¸', username: 'ì‚¬ìš©ì ì´ë¦„', password: 'ë¹„ë°€ë²ˆí˜¸', login: 'ë¡œê·¸ì¸', tips: 'ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”', back: 'â† ì›Œí¬ìŠ¤í˜ì´ìŠ¤' }
        };
        
        let currentLang = localStorage.getItem('lang') || 'zh';
        document.getElementById('langSelect').value = currentLang;
        
        function changeLang(lang) {
            currentLang = lang;
            localStorage.setItem('lang', lang);
            updateLabels();
        }
        
        function updateLabels() {
            const t = i18n[currentLang] || i18n.zh;
            document.getElementById('titleText').textContent = t.title;
            document.getElementById('subtitleText').textContent = t.subtitle;
            document.getElementById('username').placeholder = t.username;
            document.getElementById('password').placeholder = t.password;
            document.getElementById('loginBtn').textContent = t.login;
            document.getElementById('tipsText').innerHTML = '<p>' + t.tips + '</p>';
            document.getElementById('backLink').textContent = t.back;
        }
        
        updateLabels();
        
        // æ£€æŸ¥æ˜¯å¦å·²ç™»å½•
        const stored = localStorage.getItem('commune_user');
        if (stored) {
            try {
                const u = JSON.parse(stored);
                if (u.username) {
                    location.href = '/commune/chat.html';
                }
            } catch(e) {}
        }

        // ç™»å½•
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            const errorMsg = document.getElementById('errorMsg');
            
            fetch('/api/commune/user.php?action=login', {
                method: 'POST',
                headers: {'Content-Type': 'application/x-www-form-urlencoded'},
                body: 'username=' + encodeURIComponent(username) + '&password=' + encodeURIComponent(password),
                credentials: 'include'
            })
            .then(r => r.json())
            .then(data => {
                if (data.code === 1) {
                    localStorage.setItem('commune_user', JSON.stringify(data.data));
                    location.href = '/commune/chat.html';
                } else {
                    errorMsg.textContent = data.msg || 'ç™»å½•å¤±è´¥';
                    errorMsg.style.display = 'block';
                }
            })
            .catch(e => {
                errorMsg.textContent = 'ç™»å½•å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•';
                errorMsg.style.display = 'block';
            });
        });
    </script>
</body>
</html>
