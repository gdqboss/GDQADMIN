<!DOCTYPE html><!--custom_file(wx_channels)-->
<html>
<head>
    <meta charset="utf-8">
    <title>直播列表</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    {include file="public/css"/}
    <style>
        #urlqr img {
            margin: 0 auto
        }
    </style>
</head>
<body>
<div class="layui-fluid">
    <div class="layui-row layui-col-space15">
        <div class="layui-card layui-col-md12">
            <div class="layui-card-header">
                <i class="fa fa-list"></i> 直播预告列表
                {if input('param.id')}
                <i class="layui-icon layui-icon-close" style="font-size:18px;font-weight:bold;cursor:pointer"
                   onclick="closeself()"></i>
                {/if}
            </div>
            <div class="layui-card-body" pad15>
                <blockquote class="layui-elem-quote">提示：需要先去视频号助手-直播-直播管理-创建直播预告，此处数据需要手动添加用来引流，暂无接口可以同步预告数据。</blockquote>
                <div class="layui-col-md6" style="padding-bottom:10px">
                    <a class="layui-btn layuiadmin-btn-list" href="javascript:void(0)" onclick="openmax('{:url(\'edit\')}/shop_id/{$Request.get.id}')">
						<i class="fa fa-plus"></i>创建直播预告
					</a>
                    <button class="layui-btn layui-btn-primary" onclick="showurl('{$Request.get.id}')">活动链接</button>
                </div>
                <div class="layui-form layui-col-md6 layui-form-search">
                    <div class="layui-inline layuiadmin-input-useradmin">
                        <label class="layui-form-label">直播主题</label>
                        <div class="layui-input-inline">
                            <input type="text" name="live_title" autocomplete="off" class="layui-input" value="">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <button class="layui-btn layuiadmin-btn-replys" lay-submit="" lay-filter="LAY-app-forumreply-search">
                            <i class="layui-icon layui-icon-search layuiadmin-button-btn"></i>
                        </button>
                    </div>
                </div>
                <div class="layui-col-md12">
                    <table id="tabledata" lay-filter="tabledata"></table>
                </div>
            </div>
        </div>
    </div>
</div>
{include file="public/js"/}
<script>
    layui.laydate.render({
        elem: '#ctime',
        trigger: 'click',
        range: '~' //或 range: '~' 来自定义分割字符
    });
    var table = layui.table;
    var datawhere = {};
    //数据表
    var tableIns = table.render({
        elem: '#tabledata'
        , url: "{$Request.url}" //数据接口
        , page: true //开启分页
        , cols: [[ //表头
            {type: "checkbox"},
            {field: 'id', title: 'ID', width: 80},
            {field: 'content', title: '直播主题'},
            {field: 'live_start_time', title: '开播时间',width: 180, templet: function (d) {
                return d.live_start_time ? date('Y-m-d H:i:s', d.live_start_time) : ''
            }},
            {field: 'reserve_num',  width: 100,align: 'center', title: '预约人数'},
            // {field: 'live_status',  width: 100,align: 'center', title: '直播状态',templet:function(d){
            //     if(d.live_status==0){
            //         return '直播预告';
            //     }else if(d.live_status==1){
            //         return '超时未开播';
            //     }else if(d.live_status==2){
            //         return '取消直播预告';
            //     }else if(d.live_status==3){
            //         return '已开播';
            //     }else if(d.live_status==4){
            //         return '直播结束';
            //     }
            // }},
            {field: 'operation', title: '操作', width: 200, templet: function (d) {
                var html = '';
                html += '<button class="table-btn" onclick="openmax(\'{:url('edit')}/id/' + d.id + '/shop_id/' + d.shop_id + '\')">编辑</button>';
                html += '<button class="table-btn" onclick="datadel('+d.id+')">删除</button>';
                html += '<button class="table-btn" onclick="openmax(\'{:url('recordMember')}/id/' + d.id + '\')">预约人员</button>';
                return html;
			}}
        ]]
    });
    //排序
    table.on('sort(tabledata)', function (obj) {
        datawhere.field = obj.field;
        datawhere.order = obj.type;
        tableIns.reload({
            initSort: obj,
            where: datawhere
        });
    });
    //检索
    layui.form.on('submit(LAY-app-forumreply-search)', function (obj) {
        var field = obj.field
        var olddatawhere = datawhere
        datawhere = field
        datawhere.field = olddatawhere.field
        datawhere.order = olddatawhere.order
        tableIns.reload({
            where: datawhere,
            page: {curr: 1}
        });
    });
    //删除
    function datadel(id){
        var ids = [];
        if(id==0){
            var checkStatus = table.checkStatus('tabledata')
            var checkData = checkStatus.data; //得到选中的数据
            if(checkData.length === 0){
                return layer.msg('请选择数据');
            }
            var ids = [];
            for(var i=0;i<checkData.length;i++){
                ids.push(checkData[i]['id']);
            }
        }else{
            ids.push(id)
        }
        layer.confirm('确定要删除吗？删除后无法恢复！',{icon: 7, title:'操作确认'}, function(index){
            layer.close(index);
            var index = layer.load();
            $.post("{:url('del')}",{ids:ids},function(data){
                layer.close(index);
                dialog(data.msg,data.status);
                tableIns.reload()
            })
        });
    }
    function showurl(id){
        {if $bid}
            var pagepath = 'pagesB/channels_live/index?id='+id+"&bid={$bid}";
        {else}
            var pagepath = 'pagesB/channels_live/index?id='+id;
        {/if}
        viewLink(pagepath);
    }

</script>
{include file="public/copyright"/}
<div id="NewsToolBox"></div>
</body>
</html>