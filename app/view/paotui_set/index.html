<!DOCTYPE html><!--custom_file(paotui)-->
<html>
<head>
  <meta charset="utf-8">
  <title>跑腿设置</title>
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
  {include file="public/css"/}
    <script src="__STATIC__/admin/js/address3.js?v=1"></script>
    <style>
    #ggtable .layui-input{ display:inline;height:30px}
    #ggtable .layui-btn{ margin-top:-3px;margin-left:1px}
    </style>
</head>
<body>
  <div class="layui-fluid">
    <div class="layui-row layui-col-space15">
      <div class="layui-card layui-col-md12">
                <div class="layui-card-header">
                   跑腿设置
                </div>
                <div class="layui-card-body" pad15>
                    <div class="layui-form form-label-w8" lay-filter="">
                        <blockquote class="layui-elem-quote">跑腿不支持线下转账、货到付款支付，需要线上直接付款<br></blockquote>
                        <input type="hidden" name="info[id]" value="{$info['id']}">
                        <div class="layui-form-item" >
                            <label class="layui-form-label">配送端：</label>
                            <div class="layui-input-inline" style="width:350px">
                                <input type="radio" name="info[type]" value="0" {if $info['type']==0}checked{/if} title="系统配送">
                                <input type="radio" name="info[type]" value="1" {if $info['type']==1}checked{/if} title="{:t('码科')}配送">
                                
                            </div>
                            <div class="layui-form-mid layui-word-aux"> 跑腿开启后将会把订单推送到设置的配送端中，请确保配送端参数正常</div>
                        </div>
                        <div class="layui-form-item" >
                            <label class="layui-form-label">跑腿区域：</label>
                            <div class="layui-input-inline" style="width:calc(100% - 300px)">
                                <div id="modal-areas" ></div>
                            </div>
                        </div>
                        <div class="layui-form-item" >
                            <label class="layui-form-label">最远距离：</label>
                            <div class="layui-input-inline" style="width: 100px;">
                                <input type="number" name="info[max_distance]"  class="layui-input" value="{$info['max_distance']}">
                            </div>
                            <div class="layui-form-mid layui-word-aux"> 公里 &nbsp;&nbsp;&nbsp;取货地址与收货地址之间的最远距离，超出不能配送</div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">距离费用：</label>
                            <div class="layui-input-inline" style="width: 100px;">
                                <input type="number" name="info[distance_one]" class="layui-input" value="{$info.distance_one}">
                            </div>
                            <div class="layui-form-mid">公里内</div>
                            <div class="layui-input-inline" style="width: 100px;">
                                <input type="number" name="info[distance_fee_one]" class="layui-input" value="{$info.distance_fee_one}">
                            </div>
                            <div class="layui-form-mid">元；每超出</div>
                            <div class="layui-input-inline" style="width: 100px;">
                                <input type="number" name="info[distance_two]" class="layui-input" value="{$info.distance_two}">
                            </div>
                            <div class="layui-form-mid">公里，加</div>
                            <div class="layui-input-inline" style="width: 100px;">
                                <input type="number" name="info[distance_fee_two]" class="layui-input" value="{$info.distance_fee_two}">
                            </div>
                            <div class="layui-form-mid">元</div>
                        </div>
                        <div class="layui-form-item" >
                            <label class="layui-form-label">最大重量：</label>
                            <div class="layui-input-inline" style="width: 100px;">
                                <input type="number" name="info[max_weight]"  class="layui-input" value="{$info['max_weight']?$info['max_weight']:10}">
                            </div>
                            <div class="layui-form-mid layui-word-aux"> 公斤 超出最大重量不能配送</div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">重量费用：</label>
                            <div class="layui-input-inline" style="width: 100px;">
                                <input type="number" name="info[weight_one]" class="layui-input" value="{$info.weight_one}">
                            </div>
                            <div class="layui-form-mid">公斤内</div>
                            <div class="layui-input-inline" style="width: 100px;">
                                <input type="number" name="info[weight_fee_one]" class="layui-input" value="{$info.weight_fee_one}">
                            </div>
                            <div class="layui-form-mid">元；每超出</div>
                            <div class="layui-input-inline" style="width: 100px;">
                                <input type="number" name="info[weight_two]" class="layui-input" value="{$info.weight_two}">
                            </div>
                            <div class="layui-form-mid">公斤，加</div>
                            <div class="layui-input-inline" style="width: 100px;">
                                <input type="number" name="info[weight_fee_two]" class="layui-input" value="{$info.weight_fee_two}">
                            </div>
                            <div class="layui-form-mid">元</div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label"><span class="redstar">*</span>物品默认图片：</label>
                            <input type="hidden" name="info[pic]" id="pic" lay-verType="tips" class="layui-input" value="{$info['pic']}">
                            <button style="float:left;" type="button" class="layui-btn layui-btn-primary" upload-input="pic" upload-preview="picPreview" onclick="uploader(this)">上传图片</button>
                            <div class="layui-form-mid layui-word-aux" style="margin-left:10px;">客户不上传物品图片时默认显示的图片 建议尺寸：350*350 </div>
                            <div id="picPreview" style="float:left;padding-top:10px;padding-left:160px;clear: both;">
                                <div class="layui-imgbox" style="width:100px;"><div class="layui-imgbox-img"><img src="{$info['pic']}"/></div></div>
                            </div> 
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">计价规则：</label>
                            <div class="layui-input-inline" style="width:500px">
                                <script id="content" name="info[content]" type="text/plain" style="width:100%;height:400px">{$info.content}</script>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">状态：</label>
                            <div class="layui-input-inline" style="width: 300px">
                                <input type="radio" name="info[status]" value="1" {if $info['status']==1}checked{/if} title="开启"/>
                                <input type="radio" name="info[status]" value="0" {if $info['status']==0}checked{/if} title="关闭"/>
                            </div>
                        </div>
                        <div class="layui-form-item">
													<label class="layui-form-label"></label>
                            <div class="layui-input-block">
                                <button class="layui-btn"   lay-submit lay-filter="formsubmit">提 交</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
  </div>
    <style type='text/css'>
    .modal-areas .layui-layer-content{ position:static;overflow:visible;height:300px}
    .province { float:left; position:relative;width:210px; height:35px; line-height:35px;border:1px solid #fff;}
    .province:hover { border:1px solid #f7e4a5;border-bottom:1px solid #fffec6; background:#fffec6;}
    .province .cityall { margin-top:10px;}
    .province ul { list-style: outside none none;position:absolute;padding:0;background:#fffec6;border:1px solid #f7e4a5;display:none;width:auto; width:300px; z-index:999999;left:-1px;top:32px;}
    .province ul li  { float:left;min-width:60px;margin-left:20px; height:30px;line-height:30px; }
    </style>

    {include file="public/js"/}
    <script>
    var ueditor = UE.getEditor('content');
    var area = {$area?$area:'0'};
    $(function(){
        var regiondata = '';
        for(var i in provinceList){
            if(i>0){
                var province = provinceList[i];
                regiondata+='<div class="province">';
                regiondata+='           <label class="checkbox-inline" style="margin-left:20px;">';
                regiondata+='               <input type="checkbox" class="cityall" style="display:inline-block" province="'+province.name+'"/> '+province.name;
                regiondata+='               <span class="citycount" style="color:#ff6600"></span>';
                regiondata+='           </label>';
                if(province.cityList){
                    regiondata+='       <ul>';
                    for(var j in province.cityList){
                        var city = province.cityList[j];
                        if(city.name != '省直辖县级行政区划' && city.name != '县' && city.name != '自治区直辖县级行政区划'){
                            regiondata+='       <li>';
                            regiondata+='           <label class="checkbox-inline">';
                            regiondata+='               <input type="checkbox" class="city" style="margin-top:8px;display:inline-block" city="'+city.name+'" /> '+city.name;
                            regiondata+='           </label>';
                            regiondata+='       </li>';
                        }
                    }
                    regiondata+='       </ul>';
                }
                regiondata+='</div>';
            }
        }
        $('#modal-areas').html(regiondata);

        $('.province').mouseover(function(){
            $(this).find('ul').show();
        }).mouseout(function(){
            $(this).find('ul').hide();
        });

        $('.cityall').click(function(){
            var checked = $(this).get(0).checked;
            var citys = $(this).parent().parent().find('.city');
            citys.each(function(){
                $(this).get(0).checked = checked;
            });
            var count = 0;
            if(checked){
                count =  $(this).parent().parent().find('.city:checked').length;
            }
            if(count>0){
                $(this).next().html("(" + count + ")")    ;
            }else{
                $(this).next().html("");
            }
        });

        $('.city').click(function(){
            var checked = $(this).get(0).checked;
            var cityall = $(this).parent().parent().parent().parent().find('.cityall');
            if(checked){
                cityall.get(0).checked = true;
            }
            var count = cityall.parent().parent().find('.city:checked').length;
            if(count>0){
                cityall.next().html("(" + count + ")")    ;
            }else{
                cityall.next().html("");
            }
        });
        setTimeout(function(){
            editArea(area);
        },400)
    })

    function editArea(area=''){
        if(area){
            for(var i in area){
                if(area[i] == ''){
                    continue;
                }
                var provincecity = area[i];
                $('input[province='+provincecity[0]+']').prop('checked',true);

                var citys = provincecity[1].split(',');
                var citycount = 0;
                for(var j in citys){
                    citycount++;
                    $('input[province='+provincecity[0]+']').parent().parent().find('.city[city='+citys[j]+']').prop('checked',true);
                }
                $('input[province='+provincecity[0]+']').next('.citycount').html('('+citycount+')');
            }
        }
    }
    var current = '';
    function clearSelects(){
        $('.city').attr('checked',false).removeAttr('disabled');
        $('.cityall').attr('checked',false).removeAttr('disabled');
        $('.citycount').html('');
    }

    layui.form.on('submit(formsubmit)', function(obj){
        var citystrs = '';
        $('.cityall:checked').each(function(){
            var citychecked = [];
            $(this).parent().parent().find('.city:checked').each(function(){
                citychecked.push($(this).attr('city'));
            });
            citystrs+=$(this).attr('province') + '-'+citychecked.join(',') + ';';
        })

        var field = obj.field;
        field['citys'] = citystrs;
        field['info[content]'] = ueditor.getContent();
        var index = layer.load();
        $.post("{:url('save')}",field,function(data){
            layer.close(index);
            dialog(data.msg,data.status,data.url);
        })
    })
  </script>
    {include file="public/copyright"/}
</body>
</html>