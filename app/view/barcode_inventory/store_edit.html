<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>{$cfg['title']} - {$title}</title>
    {include file="public/css"/}
    <style>
        /* 美化表单样式 */
        .layui-form-item {
            margin-bottom: 20px;
        }
        
        /* 美化必填项标记 */
        .redstar {
            color: #ff5722;
            margin-right: 4px;
            font-weight: bold;
        }
        
        /* 美化表单 */
        .form-container {
            max-width: 600px;
            margin: 0 auto;
        }
        
        /* 美化按钮 */
        .layui-btn {
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="layui-fluid">
        <div class="layui-row layui-col-space15">
            <div class="layui-card layui-col-md12">
                <div class="layui-card-header">
                    <i class="fa fa-home"></i> {$title}
                    <button class="layui-btn layui-btn-sm layui-btn-primary pull-right" onclick="window.location.href='/?s=/BarcodeInventory/store_list'">
                        <i class="fa fa-arrow-left"></i> {:t('返回门店列表')}
                    </button>
                </div>
                <div class="layui-card-body" pad15>
                    <div class="form-container">
                        <form class="layui-form" action="" method="post" id="storeForm">
                            <!-- 门店ID -->
                            {if isset($info.id)}
                            <input type="hidden" name="id" value="{$info.id}">
                            {/if}
                            
                            <!-- 经销商ID -->
                            <div class="layui-form-item">
                                <label class="layui-form-label"><span class="redstar">*</span>{:t('经销商')}：</label>
                                <div class="layui-input-block">
                                    <select name="dealer_id" id="dealer_id" lay-search class="layui-select" required>
                                        <option value="">{:t('请选择经销商')}</option>
                                        {volist name="dealers" id="dealer"}
                                        <option value="{$dealer.id}" {if (isset($info.dealer_id) && $info.dealer_id == $dealer.id) || (isset($_GET['dealer_id']) && $_GET['dealer_id'] == $dealer.id)}selected{/if}>{$dealer.dealer_name}</option>
                                        {/volist}
                                    </select>
                                </div>
                            </div>
                            
                            <!-- 门店名称 -->
                            <div class="layui-form-item">
                                <label class="layui-form-label"><span class="redstar">*</span>{:t('门店名称')}：</label>
                                <div class="layui-input-block">
                                    <input type="text" name="store_name" id="store_name" placeholder="{:t('请输入门店名称')}" 
                                           class="layui-input" required value="{$info.store_name|default=''}">
                                </div>
                            </div>
                            
                            <!-- 负责人 -->
                            <div class="layui-form-item">
                                <label class="layui-form-label"><span class="redstar">*</span>{:t('负责人')}：</label>
                                <div class="layui-input-block">
                                    <input type="text" name="contact_person" id="contact_person" placeholder="{:t('请输入负责人')}" 
                                           class="layui-input" required value="{$info.contact_person|default=''}">
                                </div>
                            </div>
                            
                            <!-- 联系电话 -->
                            <div class="layui-form-item">
                                <label class="layui-form-label"><span class="redstar">*</span>{:t('联系电话')}：</label>
                                <div class="layui-input-block">
                                    <input type="text" name="phone" id="phone" placeholder="{:t('请输入联系电话')}" 
                                           class="layui-input" required value="{$info.phone|default=''}">
                                </div>
                            </div>
                            
                            <!-- 经营地址 -->
                            <div class="layui-form-item">
                                <label class="layui-form-label"><span class="redstar">*</span>{:t('经营地址')}：</label>
                                <div class="layui-input-block">
                                    <input type="text" name="address" id="address" placeholder="{:t('请输入经营地址')}" 
                                           class="layui-input" required value="{$info.address|default=''}">
                                </div>
                            </div>
                            
                            <!-- 是否主店 -->
                            <div class="layui-form-item">
                                <label class="layui-form-label">{:t('是否主店')}：</label>
                                <div class="layui-input-block">
                                    <input type="checkbox" name="is_main" id="is_main" lay-skin="switch" lay-text="{:t('是')}|{:t('否')}" 
                                           {if isset($info.is_main) && $info.is_main == 1}checked{/if}>
                                </div>
                            </div>
                            
                            <!-- 提交按钮 -->
                            <div class="layui-form-item">
                                <div class="layui-input-block">
                                    <button class="layui-btn" type="submit" lay-submit lay-filter="storeSubmit">
                                        <i class="fa fa-check"></i> {:t('提交')}
                                    </button>
                                    <button class="layui-btn layui-btn-primary" type="button" onclick="window.location.href='/?s=/BarcodeInventory/store_list'">
                                        <i class="fa fa-arrow-left"></i> {:t('返回')}
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 底部脚本 -->
    {include file="public/js"/}
    
    <script>
        layui.use(['form', 'layer'], function() {
            var form = layui.form;
            var layer = layui.layer;
            
            // 渲染表单
            form.render();
            
            // 表单提交
            form.on('submit(storeSubmit)', function(data) {
                // 显示加载中
                var loadingIndex = layer.load(2);
                
                $.ajax({
                    url: '{:isset($info.id) ? url("BarcodeInventory/edit_store") : url("BarcodeInventory/add_store")}',
                    type: 'POST',
                    data: data.field,
                    dataType: 'json',
                    success: function(res) {
                        layer.close(loadingIndex);
                        if (res.status == 1) {
                            layer.msg(res.msg, {icon: 1, time: 1500}, function() {
                                window.location.href = '/?s=/BarcodeInventory/store_list';
                            });
                        } else {
                            layer.msg(res.msg, {icon: 2});
                        }
                    },
                    error: function() {
                        layer.close(loadingIndex);
                        layer.msg('{:t('网络错误，请稍后重试')}', {icon: 2});
                    }
                });
                
                return false;
            });
        });
    </script>
</body>
</html>