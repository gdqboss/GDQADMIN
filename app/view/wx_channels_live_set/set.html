<!DOCTYPE html><!--custom_file(wx_channels)-->
<html>
<head>
	<meta charset="utf-8">
	<title>预约直播设置</title>
	<meta name="renderer" content="webkit">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
	{include file="public/css"/}
</head>
<body>
<div class="layui-fluid">
	<div class="layui-row layui-col-space15">
		<div class="layui-card layui-col-md12">
			<div class="layui-card-header">
				<i class="fa fa-cog"></i> 预约直播设置
			</div>
			<div class="layui-card-body" pad15>
				<div class="flex">
					<div class="layui-form form-label-w8" lay-filter="">
						<div class="layui-form-item">
							<label class="layui-form-label"><span class="redstar">*</span>顶部描述：</label>
							<div class="layui-input-inline" style="width:300px">
								<input type="hidden" name="id" value="{$info['id']}"/>
								<textarea class="layui-textarea" name="info[desc]" lay-verify="required" lay-verType="tips">{$info.desc}</textarea>
							</div>
						</div>
						<div class="layui-form-item">
							<label class="layui-form-label">背景图片：</label>
							<input type="hidden" name="info[bgpic]" id="bgpic" lay-verType="tips" class="layui-input" value="{$info.bgpic}">
							<button style="float:left;" type="button" class="layui-btn layui-btn-primary" upload-input="bgpic" upload-preview="bgpicPreview" onclick="uploader(this)">上传图片</button>
							<div class="layui-form-mid layui-word-aux" style="margin-left:10px;">建议尺寸：750*1340像素</div>
							<div id="bgpicPreview" class="picsList-class-padding">
								<div class="layui-imgbox" style="width:100px;">
<!--									<a class="layui-imgbox-close" href="javascript:void(0)" onclick="$('#bgpic').val('');$('#show_bgpic').attr('src','');" title="删除">-->
<!--										<i class="layui-icon layui-icon-close-fill-opaque"></i>-->
<!--									</a>-->
									<div class="layui-imgbox-img">
										<img src="{$info.bgpic}" id="show_bgpic"/>
									</div>
								</div>
							</div>
						</div>
						<div class="layui-form-item">
							<label class="layui-form-label">背景色：</label>
							<div class="layui-input-inline">
								<input type="text" name="info[bgcolor]" value="{$info['bgcolor']}" class="layui-input">
							</div>
							<div class="_colorpicker" style="float:left"></div>
						</div>
						<div class="layui-form-item">
							<label class="layui-form-label">字体颜色：</label>
							<div class="layui-input-inline">
								<input type="text" name="info[fontcolor]" value="{$info['fontcolor']}" class="layui-input">
							</div>
							<div class="_colorpicker" style="float:left"></div>
						</div>
						<div class="layui-form-item" {if $bid}style="display:none;"{/if}>
							<label class="layui-form-label">预约直播送{:t('积分')}：</label>
							<div class="layui-input-inline">
								<input type="radio" name="info[give_score]" value="1" {if $info['give_score']==1}checked{/if} title="开启" lay-filter="give_score"/>
								<input type="radio" name="info[give_score]" value="0" {if $info['give_score']==0}checked{/if} title="关闭" lay-filter="give_score"/>
							</div>
						</div>
						<div class="layui-form-item give_score_div" {if $bid || !$info.give_score}style="display:none;"{/if}>
							<label class="layui-form-label">预约赠送{:t('积分')}：</label>
							<div class="layui-input-inline">
								<input type="number" class="layui-input" value="{$info.reservation_give_score}" name="info[reservation_give_score]">
							</div>
							<div class="layui-form-mid">{:t('积分')}</div>
							<div class="layui-form-mid layui-word-aux">预约直播成功后赠送</div>
						</div>
						<div class="layui-form-item give_score_div" {if !$info.give_score}style="display:none;"{/if}>
							<label class="layui-form-label">每日最多赠送：</label>
							<div class="layui-input-inline" >
								<input type="number" class="layui-input" value="{$info.day_give_score}" name="info[day_give_score]">
							</div>
							<div class="layui-form-mid">{:t('积分')}</div>
							<div class="layui-form-mid layui-word-aux">每个用户每天最多获得多少{:t('积分')}</div>
						</div>
						<div class="layui-form-item">
							<label class="layui-form-label"><span class="redstar">*</span>活动规则：</label>
							<div class="layui-input-inline" style="width:300px">
								<textarea class="layui-textarea" name="info[guize]" lay-verify="required" lay-verType="tips">{$info.guize}</textarea>
							</div>
						</div>
						<div class="layui-form-item">
							<label class="layui-form-label">预约直播送{:t('优惠券')}：</label>
							<div class="layui-input-inline">
								<input type="radio" name="info[give_coupon]" value="1" {if $info['give_coupon']==1}checked{/if} title="开启" lay-filter="give_coupon"/>
								<input type="radio" name="info[give_coupon]" value="0" {if $info['give_coupon']==0}checked{/if} title="关闭" lay-filter="give_coupon"/>
							</div>
						</div>
						<div class="layui-form-item give_coupon_div" {if !$info.give_coupon}style="display:none;"{/if}>
							<label class="layui-form-label"></label>
							<div class="layui-input-inline" style="width:auto; overflow: hidden;">
								<table class="layui-table choose-coupon" style="width:500px" id="choose-coupon">
									<thead>
									<tr>
										<th>ID</th>
										<th>名称</th>
										<th>库存</th>
										<th>发放数量</th>
										<th>操作</th>
									</tr>
									</thead>
									{if $couponList}
									{foreach $couponList as $k=>$ff}
									<tr class="choose-tr-list">
										<td>{$ff.id}</td>
										<td>{$ff.name}</td>
										<td>{$ff.stock}</td>
										<td>
											<input type="hidden" name="info[coupon_list][coupon_id][]" value="{$ff.id}">
											<input type="number" name="info[coupon_list][coupon_num][]" class="layui-input" value="{$ff.coupon_num}">
										</td>
										<td>
											<button type="button" class="layui-btn layui-btn-sm layui-btn-primary" onclick="delChooseTr(this,{$ff.id})">删除</button>
										</td>
									</tr>
									{/foreach}
									{/if}
									<tr class="choose-tr-add">
										<td colspan="5"><button type="button" class="layui-btn layui-btn-sm layui-btn-primary" onclick="showChooseCoupon()">添加</button></td>
									</tr>
								</table>
								<div class="layui-form-mid layui-word-aux">请确认{:t('优惠券')}的有效期、库存有效</div>
							</div>
							<script>
								var chooseCouponLayer;
								function showChooseCoupon(){
									chooseCouponLayer = layer.open({type:2,title:'选择{:t(\'优惠券\')}',content:"{:url('Coupon/choosecoupon')}",area:['1000px','600px'],shadeClose:true});
								}
								function choosecoupon(res){
									var detail = res;
									var chooseClassName = '.choose-coupon';
									layer.close(chooseCouponLayer);
									var isadd = 0;
									$(chooseClassName).find('.choose-tr-list').each(function(){
										var thisfid = $(this).find('td:eq(0)').html();
										if(thisfid == detail.id){
											isadd = 1
											dialog('该项已添加过了');
										}
									})
									if(isadd == 0){
										var tr = '<tr class="choose-tr-list">' +
												'<td>'+detail.id+'</td>' +
												'<td>'+detail.name+'</td>' +
												'<td>'+detail.stock+'</td>' +
												'<td>' +
												'<input type="hidden" name="info[coupon_list][coupon_id][]" value="'+ detail.id+'"/>' +
												'<input type="number" name="info[coupon_list][coupon_num][]" value="1" class="layui-input"/>' +
												'</td>' +
												'<td>' +
												'<button type="button" class="layui-btn layui-btn-sm layui-btn-primary" onclick="delChooseTr(this,'+detail.id+')">删除</button>' +
												'</td>' +
												'</tr>';
										$(chooseClassName).find('.choose-tr-add').before(tr);
									}
								}
								function delChooseTr(obj,fid){
									$(obj).closest('.choose-tr-list').remove();
								}
							</script>
						</div>
						分享设置<hr/>
						<div class="layui-form-item">
							<label class="layui-form-label">分享标题：</label>
							<div class="layui-input-inline" style="width:300px">
								<input type="text" class="layui-input" name="info[sharetitle]" value="{$info.sharetitle}"/>
							</div>
							<div class="layui-form-mid layui-word-aux">默认为活动名称</div>
						</div>
						<div class="layui-form-item">
							<label class="layui-form-label">分享图标：</label>
							<input type="hidden" name="info[sharepic]" id="sharepic" lay-verType="tips" class="layui-input" value="{$info.sharepic}">
							<button style="float:left;" type="button" class="layui-btn layui-btn-primary" upload-input="sharepic" upload-preview="sharepicPreview" onclick="uploader(this)">上传图片</button>
							<div class="layui-form-mid layui-word-aux" style="margin-left:10px;">建议尺寸：400*400像素</div>
							<div id="sharepicPreview" class="picsList-class-padding">
								<div class="layui-imgbox" style="width:100px;"><div class="layui-imgbox-img"><img src="{$info.sharepic}"/></div></div>
							</div>
						</div>
						<div class="layui-form-item">
							<label class="layui-form-label">分享描述：</label>
							<div class="layui-input-inline" style="width:300px">
								<input type="text" class="layui-input" name="info[sharedesc]" value="{$info.sharedesc}"/>
							</div>
							<div class="layui-form-mid layui-word-aux"></div>
						</div>
						<div class="layui-form-item">
							<label class="layui-form-label">分享链接：</label>
							<div class="layui-input-inline" style="width:300px">
								<input type="text" class="layui-input" name="info[sharelink]" value="{$info.sharelink}"/>
							</div>
							<div class="layui-form-mid layui-word-aux" >默认为活动链接，设置后发送给朋友或分享到朋友圈，点击后会跳转到此链接地址</div>
						</div>
						<div class="layui-form-item">
							<label class="layui-form-label"></label>
							<div class="layui-input-block">
								<button class="layui-btn" lay-submit lay-filter="formsubmit">提 交</button>
							</div>
						</div>
					</div>
					<div>
						<div class="dsn-phone">
							<div class="dsn-phone-left"></div>
							<div class="dsn-phone-center">
								<div class="dsn-phone-top"></div>
								<div class="dsn-phone-main">
									<div id="editor">
										<div class="dsn-mod dsn-topbar dsn-mod-nohover" style="color:#fff;background:#000;height:60px">
											<div style="float:left;width:100%;font-size:12px">
												<div style="float:left;width:30%">&nbsp;<i class="fa fa-signal"></i> wechat <i class="fa fa-wifi"></i></div>
												<div style="float:left;text-align:center;width:40%">12:00</div>
												<div style="float:left;text-align:right;width:30%">100% <i class="fa fa-battery-full"></i>&nbsp;</div>
											</div>
											<div style="float:left;width:98%;margin:2px 1% 0 1%;">
												<div style="float:left;width:30%">&nbsp;</div>
												<div style="float:left;text-align:center;width:40%;font-size:16px;height:27px;line-height:27px" id="name_preview">{$info.name}</div>
											</div>
										</div>
										<div id="editor-content" style="overflow:hidden">
											<img src="__STATIC__/img/channels_live/preview.png" style="width:100%">
										</div>
									</div>
								</div>
								<div class="dsn-phone-bottom">*仅供参考，实际效果以手机端为准</div>
							</div>
							<div class="dsn-phone-right"></div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
{include file="public/js"/}
<script>
	layui.form.on('submit(formsubmit)', function(obj){
		var field = obj.field
		//console.log(field);return
		$.post("{:url('save')}",field,function(data){
			dialog(data.msg,data.status,data.url);
		})
	})

	layui.form.on('radio(give_score)', function(data){
		$('.give_score_div').hide();
		if(data.value == '1'){
			$('.give_score_div').show();
		}
	})

	layui.form.on('radio(give_coupon)', function(data){
		$('.give_coupon_div').hide();
		if(data.value == '1'){
			$('.give_coupon_div').show();
		}
	})
</script>
{include file="public/copyright"/}
</body>
</html>