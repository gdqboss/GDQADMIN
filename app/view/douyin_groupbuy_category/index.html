<!DOCTYPE html><!--custom_file(douyin_groupbuy)-->
<html>

<head>
    <meta charset="utf-8">
    <title>抖音商品分类</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    {include file="public/css"/}
    <style>
        .layui-table-body .layui-table .layui-table-cell {
            height: auto;
            line-height: auto
        }
    </style>
    <link rel="stylesheet" type="text/css" href="__STATIC__/admin/layui/lay/modules/treetable-lay/treetable.css"
        media="all">
</head>

<body>
    <div class="layui-fluid">
        <div class="layui-row layui-col-space15">
            <div class="layui-card layui-col-md12">
                <div class="layui-card-header">商品分类</div>
                <div class="layui-card-body" pad15>
                    <div class="layui-col-md8" style="padding-bottom:10px">
                        <!-- <button class="layui-btn layui-btn-primary layuiadmin-btn-list" onclick="datadel(0)">删除</button> -->
                        <button class="layui-btn layuiadmin-btn-list" id="btn-expand">全部展开</button>
                        <button class="layui-btn layuiadmin-btn-list" id="btn-fold">全部折叠</button>
                        <button class="layui-btn layuiadmin-btn-list" id="btn-refresh">刷新</button>
                        <button class="layui-btn layui-btn-primary layuiadmin-btn-list" onclick="tongbu()">同步分类</button>
                    </div>
                    <div class="xm-d2-hang2">
                        <table id="tabledata" class="layui-table" lay-filter="tabledata"></table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {include file="public/js"/}
    <script>
        var renderTable = '';
        var table = layui.table;
        layui.config({
            base: "__STATIC__/admin/layui/lay/modules/"
        }).extend({
            treetable: "treetable-lay/treetable"
        }).use(['layer', 'table', 'treetable'], function () {
            var $ = layui.jquery;
            var layer = layui.layer;
            var treetable = layui.treetable;
            // 渲染表格
            renderTable = function () {
                layer.load(2);
                var tableIns = treetable.render({
                    treeColIndex: 2,//树形图标显示在第几列
                    treeSpid: 0,//最上级的父级id
                    treeIdName: 'id',//id字段的名称
                    treePidName: 'pid',//pid字段的名称
                    treeDefaultClose: false,//是否默认折叠
                    treeLinkage: true,//父级展开时是否自动展开所有子级
                    elem: '#tabledata',
                    url: "{$Request.url}",
                    page: false,
                    cols: [[ //表头
                        { type: "checkbox" },
                        { field: 'id', title: 'ID'},
                        { field: 'name', title: '名称'},
                    ]],
                    done: function () {
                        layer.closeAll('loading');
                    }
                });
            };
            renderTable();
            //触发三个button按钮
            $('#btn-expand').click(function () {
                treetable.expandAll('#tabledata');
            });
            $('#btn-fold').click(function () {
                treetable.foldAll('#tabledata');
            });
            $('#btn-refresh').click(function () {
                renderTable();
            });
            //排序
            table.on('sort(tabledata)', function (obj) {
                datawhere.field = obj.field;
                datawhere.order = obj.type;
                renderTable();
            });
            //检索
            layui.form.on('submit(LAY-app-forumreply-search)', function (obj) {
                var field = obj.field
                var olddatawhere = datawhere
                datawhere = field
                datawhere.field = olddatawhere.field
                datawhere.order = olddatawhere.order
                renderTable();
            })
        })
        function tongbu(){
            layer.confirm('如果分类较多,同步时间会比较长,请耐心等待,确定要同步吗?',{icon: 7, title:'从抖音同步分类'}, function(index){
                layer.close(index)
                infonum = 0;
                next_openid = '';
                totalpage = 0;
                getopenidnum = 0;
                openids = [];
                countopenid = 0;
                loadingdialog = layer.open({type:1,content:'<div style="padding:10px 5px"><div class="flex-y-center"><img src="__STATIC__/admin/img/loading.gif"/><span style="font-size:20px;padding-left:5px">正在同步请勿操作...</span></div></div>',area:'300px',title:false,closeBtn:false});
                $.post("{:url('tongbu')}",{ op:'getpage'},function(data){
                    if(data.status==0){
                        layer.close(loadingdialog);
                        dialog(data.msg,data.status);
                    }else{
                        layer.msg('同步完成',{offset:'100px'});
                        layer.close(loadingdialog);
                        renderTable();
                    }
                },'json');
            });
        }
    </script>
    {include file="public/copyright"/}
</body>

</html>