<!DOCTYPE html><!--custom_file(wx_channels)-->
<html>
<head>
  <meta charset="utf-8">
  <title>打印电子面单</title>
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
  {include file="public/css"/}
</head>
<body>
  <div class="layui-fluid">
    <div class="layui-row layui-col-space15">
      <div class="layui-card layui-col-md12">
				<div class="layui-card-header">
					打印电子面单<i class="layui-icon layui-icon-close" style="font-size:18px;font-weight:bold;cursor:pointer" onclick="closeself()"></i>
				</div>
				<div class="layui-card-body" pad15>
					<div class="layui-form form-label-w6" lay-filter="">
						<input type="hidden" name="id" value="{$info['id']}">
						
						<div class="layui-form-item" id="setgg">
							<label class="layui-form-label">商品信息：</label>
							<div class="layui-input-inline" style="width:auto">
								<table id="ggnamediv"  class="layui-table" style="width:900px">
									<thead>
									<tr>
										<th style="width:400px">商品名称</th>
										<th>规格</th>
										<th>价格</th>
									</tr>
									</thead>
									{foreach $order_goods as $k=>$goods}
									<tr>
										<td>
											{$goods.product_name}
										</td>
										<td>{$goods.guige_name}</td>
										<td>{$goods.real_price}</td>
									</tr>
									{/foreach}
								</table>
							</div>
						</div>
						<div class="layui-form-item">
							<label class="layui-form-label">订单ID：</label>
							<div class="layui-form-mid">{$info.order_id}</div>
						</div>
						<div class="layui-form-item">
							<label class="layui-form-label">下单人：</label>
							<div class="layui-form-mid">{$info.openid}</div>
						</div>
						<div class="layui-form-item">
							<label class="layui-form-label">运费：</label>
							<div class="layui-input-inline"><input type="text" name="express_fee" value="{$info.freight}" class="layui-input" readonly disabled></div>
							<div class="layui-form-mid layui-word-aux"></div>
						</div>
						<div class="layui-form-item">
							<label class="layui-form-label">物流网点：</label>
							<div class="layui-input-inline">
								<select name="acct_id">
									{foreach $delivery_arr as $delivery}
									<option value="{$delivery['acct_id']}">{$delivery['site_name']}</option>
									{/foreach}
								</select>
							</div>
							<div class="layui-form-mid layui-word-aux"></div>
						</div>
						<div class="layui-form-item">
							<input type="hidden" name="id" value="{$info['id']}" />
							<label class="layui-form-label">模板类型：</label>
							<div class="layui-input-inline" style="width: 300px;">
								<input type="radio" name="template_type" title="标准模板" checked value="0" lay-filter="template_type"/>
								<input type="radio" name="template_type" title="后台模板" value="1" lay-filter="template_type"/>
							</div>
							<div class="layui-form-mid layui-word-aux"></div>
						</div>
						<div class="layui-form-item" id="templave_div" style="display: none;">
							<label class="layui-form-label">面单模板：</label>
							<input type="hidden" name="template_id" />
							<div class="layui-form-mid" id="template_name">

							</div>
							<div class="layui-btn layui-btn-primary" style="float:left" onclick="showChoosTemplate()">选择模板</div>
						</div>
						<script>
							var chooseChoosTemplateLayer;
							function showChoosTemplate(){
								var bank_code = $('input[name="bank_code"]').val();
								var city_code = $('#city_code').val();
								if(city_code==''){
									layer.msg('请先选择区域')
									return ;
								}
								if(bank_code==''){
									layer.msg('请先选择开户银行')
									return ;
								}
								chooseChoosTemplateLayer = layer.open({type:2,title:'选择产品',content:"{:url('WxChannelsEwaybill/choosetemplate')}",area:['1000px','600px'],shadeClose:true});
							}
							function choosetemplate(res) {
								console.log(res);
								var detail = res;
								$('#template_name').html(detail.template_name+'-'+detail.template_id);
								$('input[name="template_id"]').val(detail.template_id);
							}
						</script>

						<div class="layui-form-item">
							<label class="layui-form-label">发件地址：</label>
							<input type="hidden" name="address_id" />
							<div class="layui-form-mid" id="address_div">

							</div>
							<div class="layui-btn layui-btn-primary" style="float:left" onclick="showChoosAddress()">选择地址</div>
						</div>
						<script>
							var chooseChoosTemplateLayer;
							function showChoosAddress(){
								var bank_code = $('input[name="bank_code"]').val();
								var city_code = $('#city_code').val();
								if(city_code==''){
									layer.msg('请先选择区域')
									return ;
								}
								if(bank_code==''){
									layer.msg('请先选择开户银行')
									return ;
								}
								chooseChoosTemplateLayer = layer.open({type:2,title:'选择发货地址',content:"{:url('WxChannelsAddress/choosechanelsaddress')}",area:['1000px','600px'],shadeClose:true});
							}
							function choosechannelsaddress(res) {
								console.log(res);
								var detail = res;
								$('#address_div').html(detail.user_name+'-'+detail.province_name+'-'+detail.city_name+'-'+detail.county_name);
								$('input[name="address_id"]').val(detail.id);
							}
						</script>
						<div class="layui-form-item">
							<label class="layui-form-label">备注：</label>
							<div class="layui-input-inline"><input type="text" name="remark" value="" class="layui-input" /></div>
							<div class="layui-form-mid layui-word-aux"></div>
						</div>
						<div class="layui-form-item">
							<label class="layui-form-label"></label>
							<div class="layui-input-block">
								<button class="layui-btn" lay-submit lay-filter="formsubmit">取号</button>
							</div>
						</div>
					</div>
				</div>
			</div>
    </div>
  </div>
	{include file="public/js"/}
	<script>
	layui.form.on('submit(formsubmit)', function(obj){
		var field = obj.field
		var index = layer.load();
		$.post("{:url('ewaybill')}",field,function(data){
			layer.close(index);
			if(data.status==1){
				dialog(data.msg,data.status,"{:url('ewaybill_print')}/id/{$info['id']}");
			}else{
				dialog(data.msg,data.status);
			}
		})
	})
	layui.form.on('radio(template_type)', function(data){
		if(data.value == '1'){
			$('#templave_div').show();
		}else{
			$('#templave_div').hide();
		}
	})
  </script>
	{include file="public/copyright"/}
</body>
</html>