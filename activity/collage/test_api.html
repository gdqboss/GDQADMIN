<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>API测试工具</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        input, button { padding: 8px; margin: 5px 0; }
        #response { white-space: pre-wrap; background: #f5f5f5; padding: 10px; border: 1px solid #ddd; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <div class="container">
        <h2>API Collage1/buy 测试</h2>
        <div>
            <label>产品ID (proid): <input type="text" id="proid" value="1"></label><br>
            <label>规格ID (ggid): <input type="text" id="ggid" value="1"></label><br>
            <label>购买数量 (num): <input type="text" id="num" value="1"></label><br>
            <label>购买类型 (buytype): <input type="text" id="buytype" value="2"></label><br>
            <label>拼团ID (teampid): <input type="text" id="teampid" value="0"></label><br>
            <button onclick="testApi()">测试API</button>
        </div>
        <h3>响应结果:</h3>
        <div id="response"></div>
        
        <h2>API Collage1/createOrder 测试</h2>
        <div>
            <label>产品ID (proid): <input type="text" id="order_proid" value="1"></label><br>
            <label>规格ID (ggid): <input type="text" id="order_ggid" value="1"></label><br>
            <label>购买数量 (num): <input type="text" id="order_num" value="1"></label><br>
            <label>购买类型 (buytype): <input type="text" id="order_buytype" value="2"></label><br>
            <label>拼团ID (teampid): <input type="text" id="order_teampid" value="0"></label><br>
            <label>地址ID (addressid): <input type="text" id="addressid" value="1"></label><br>
            <button onclick="testCreateOrder()">测试创建订单</button>
        </div>
        <h3>创建订单响应:</h3>
        <div id="order_response"></div>
    </div>

    <script>
        // 设置基础URL
        const baseUrl = '/'; // 替换为实际的域名
        
        function testApi() {
            const proid = document.getElementById('proid').value;
            const ggid = document.getElementById('ggid').value;
            const num = document.getElementById('num').value;
            const buytype = document.getElementById('buytype').value;
            const teampid = document.getElementById('teampid').value;
            
            const responseDiv = document.getElementById('response');
            responseDiv.innerHTML = '正在请求...';
            
            // 构建请求参数
            const params = {
                proid: proid,
                ggid: ggid,
                num: num,
                buytype: buytype,
                teampid: teampid
            };
            
            // 发送GET请求
            axios.get(baseUrl + 'ApiCollage1/buy', { params: params })
                .then(function (response) {
                    // 格式化响应数据
                    const data = response.data;
                    responseDiv.innerHTML = JSON.stringify(data, null, 2);
                    
                    // 检查关键数据是否存在
                    checkDataCompleteness(data, responseDiv);
                })
                .catch(function (error) {
                    responseDiv.innerHTML = '<span class="error">请求失败: ' + (error.message || '未知错误') + '</span>';
                    if (error.response) {
                        responseDiv.innerHTML += '<br>状态码: ' + error.response.status;
                        responseDiv.innerHTML += '<br>响应数据: ' + JSON.stringify(error.response.data, null, 2);
                    }
                });
        }
        
        function testCreateOrder() {
            const proid = document.getElementById('order_proid').value;
            const ggid = document.getElementById('order_ggid').value;
            const num = document.getElementById('order_num').value;
            const buytype = document.getElementById('order_buytype').value;
            const teampid = document.getElementById('order_teampid').value;
            const addressid = document.getElementById('addressid').value;
            
            const responseDiv = document.getElementById('order_response');
            responseDiv.innerHTML = '正在请求...';
            
            // 构建请求数据
            const data = {
                proid: proid,
                ggid: ggid,
                num: num,
                buytype: buytype,
                teampid: teampid,
                addressid: addressid
            };
            
            // 发送POST请求
            axios.post(baseUrl + 'ApiCollage1/createOrder', data)
                .then(function (response) {
                    // 格式化响应数据
                    responseDiv.innerHTML = JSON.stringify(response.data, null, 2);
                })
                .catch(function (error) {
                    responseDiv.innerHTML = '<span class="error">请求失败: ' + (error.message || '未知错误') + '</span>';
                    if (error.response) {
                        responseDiv.innerHTML += '<br>状态码: ' + error.response.status;
                        responseDiv.innerHTML += '<br>响应数据: ' + JSON.stringify(error.response.data, null, 2);
                    }
                });
        }
        
        function checkDataCompleteness(data, responseDiv) {
            const checks = [
                { name: 'status', exists: data.status !== undefined },
                { name: 'product', exists: data.product && typeof data.product === 'object' },
                { name: 'guige', exists: data.guige && typeof data.guige === 'object' },
                { name: 'freightList', exists: Array.isArray(data.freightList) },
                { name: 'userinfo', exists: data.userinfo && typeof data.userinfo === 'object' },
                { name: 'business', exists: data.business && typeof data.business === 'object' }
            ];
            
            let checkResult = '<h4>数据完整性检查:</h4><ul>';
            checks.forEach(check => {
                const statusClass = check.exists ? 'success' : 'error';
                checkResult += `<li class="${statusClass}">${check.name}: ${check.exists ? '✓ 存在' : '✗ 缺失'}</li>`;
            });
            checkResult += '</ul>';
            
            responseDiv.innerHTML += checkResult;
        }
    </script>
</body>
</html>